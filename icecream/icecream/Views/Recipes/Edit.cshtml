@model icecream.Models.Recipe

@{
 ViewData["Title"] = "Edit Recipe";
 Layout = "~/Views/Shared/_DashLayout.cshtml";
}

<style>
/* Professional edit form */
.recipe-edit-card { max-width:900px; margin:2rem auto; background:#fff; border-radius:12px; padding:1.25rem; box-shadow:08px24px rgba(31,41,55,0.06); border:1px solid rgba(0,0,0,0.04); }
.header { display:flex; align-items:center; justify-content:space-between; gap:12px; }
.title { margin:0; font-size:1.25rem; font-weight:700; }
.subtitle { color:#6b7280; }
.form-grid { display:grid; grid-template-columns:1fr1fr; gap:1rem; margin-top:1rem; }
.form-full { grid-column:1/-1; }
.form-floating > .form-control, .form-floating > .form-select { height: calc(3.4rem +2px); padding:1rem0.75rem; border-radius:8px; }
textarea.form-control { min-height:140px; padding-top:1rem; }
.image-pane { display:flex; gap:1rem; align-items:flex-start; }
.image-preview { width:180px; height:120px; border-radius:8px; overflow:hidden; border:1px solid rgba(0,0,0,0.04); background:#fafafa; display:flex; align-items:center; justify-content:center; }
.image-preview img { width:100%; height:100%; object-fit:cover; }
.file-note { color:#6c757d; font-size:0.9rem; }
.actions { display:flex; justify-content:flex-end; gap:0.6rem; margin-top:1rem; }
.btn-cancel { background:transparent; border:1px solid rgba(0,0,0,0.06); padding:.5rem .9rem; border-radius:.5rem; }
.btn-primary { background:linear-gradient(90deg,#ff6a88,#ff9076); border:none; color:#fff; padding:.5rem .95rem; border-radius:.5rem; }

/* Responsive */
@@media (max-width:767.98px) { .form-grid { grid-template-columns:1fr; } .image-preview { width:100%; height:180px; } .actions { flex-direction:column-reverse; } }
</style>

<div class="recipe-edit-card">
 <div class="header">
 <div>
 <h2 class="title">Edit Recipe</h2>
 <div class="subtitle">Update flavor details, ingredients, procedure and image</div>
 </div>
 <div class="text-muted">Recipe ID: @Model?.RecipeId</div>
 </div>

 <form asp-action="Edit" enctype="multipart/form-data" method="post" novalidate class="needs-validation">
 <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
 <input type="hidden" asp-for="RecipeId" />

 <div class="form-grid">
 <div class="form-floating form-full">
 <input asp-for="FlavorName" class="form-control" placeholder="Flavor name" />
 <label asp-for="FlavorName">Flavor name *</label>
 <span asp-validation-for="FlavorName" class="text-danger small"></span>
 </div>

 <div class="form-floating form-full">
 <textarea asp-for="Ingredients" class="form-control" placeholder="Ingredients (one per line)"></textarea>
 <label asp-for="Ingredients">Ingredients</label>
 <span asp-validation-for="Ingredients" class="text-danger small"></span>
 </div>

 <div class="form-floating form-full">
 <textarea asp-for="RecipeProcedure" class="form-control" placeholder="Preparation steps"></textarea>
 <label asp-for="RecipeProcedure">Preparation / Procedure</label>
 <span asp-validation-for="RecipeProcedure" class="text-danger small"></span>
 </div>

 <div class="form-full image-pane">
 <div style="flex:1">
 <label class="form-label">Featured image</label>
 <div class="mb-2">
 <input type="file" name="file" asp-for="ImagePath" accept="image/*" class="form-control" id="imageInput" />
 </div>
 <div class="file-note">Supported: JPG, PNG, GIF, WEBP. Recommended max size:2MB.</div>
 <span asp-validation-for="ImagePath" class="text-danger small"></span>
 </div>
 <div class="image-preview" id="imagePreviewContainer">
 <img id="imagePreview" src="@(String.IsNullOrWhiteSpace(Model?.ImagePath) ? "/images/placeholder-image.png" : Model.ImagePath)" alt="Preview" />
 </div>
 </div>

 <div>
 <div class="form-floating">
 <select asp-for="AddedByAdmin" class="form-select" asp-items="ViewBag.AddedByAdmin">
 <option value="">Select Admin</option>
 </select>
 <label asp-for="AddedByAdmin">Added by (Admin)</label>
 <span asp-validation-for="AddedByAdmin" class="text-danger small"></span>
 </div>
 </div>

 <div>
 <div class="form-floating">
 <input asp-for="CreatedAt" type="datetime-local" class="form-control" />
 <label asp-for="CreatedAt">Created at</label>
 <span asp-validation-for="CreatedAt" class="text-danger small"></span>
 </div>
 </div>
 </div>

 <div class="actions">
 <a asp-action="Index" class="btn-cancel">Cancel</a>
 <button type="submit" class="btn-primary">Save changes</button>
 </div>
 </form>
</div>

@section Scripts {
<script>
// image preview and simple validation
(function(){
 var input = document.getElementById('imageInput');
 var preview = document.getElementById('imagePreview');
 if(input){
 input.addEventListener('change', function(e){
 var file = e.target.files && e.target.files[0];
 if(!file){ preview.src = '/images/placeholder-image.png'; return; }
 var allowed = ['image/jpeg','image/png','image/gif','image/webp'];
 if(allowed.indexOf(file.type) === -1){ alert('Unsupported image format.'); input.value=''; return; }
 if(file.size >2 *1024 *1024){ alert('Image is larger than2MB.'); input.value=''; return; }
 var reader = new FileReader();
 reader.onload = function(evt){ preview.src = evt.target.result; };
 reader.readAsDataURL(file);
 });
 }

 // simple bootstrap-style client validation
 var forms = document.querySelectorAll('.needs-validation');
 Array.prototype.slice.call(forms).forEach(function(form){
 form.addEventListener('submit', function(event){
 if(!form.checkValidity()){
 event.preventDefault();
 event.stopPropagation();
 }
 form.classList.add('was-validated');
 }, false);
 });
})();
</script>
}

